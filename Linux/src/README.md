[image-id-1]: images/1.png
[image-id-2-1]: images/2.1.png
[image-id-2-2]: images/2.2.png
[image-id-2-3]: images/2.3.png
[image-id-3]: images/3.png
[image-id-4]: images/4.png
[image-id-5]: images/5.png
[image-id-6]: images/6.png
[image-id-7-nano-1]: images/7-nano-1.png
[image-id-7-nano-2]: images/7-nano-2.png
[image-id-7-nano-3]: images/7-nano-3.png
[image-id-7-nano-4]: images/7-nano-4.png
[image-id-7-vim-1]: images/7-vim-1.png
[image-id-7-vim-2]: images/7-vim-2.png
[image-id-7-vim-3]: images/7-vim-3.png
[image-id-7-vim-4]: images/7-vim-4.png
[image-id-7-joe-1]: images/7-joe-1.png
[image-id-7-joe-2]: images/7-joe-2.png
[image-id-7-joe-3]: images/7-joe-3.png
[image-id-7-joe-4]: images/7-joe-4.png
[image-id-8]: images/8.png
[image-id-9-1]: images/9-top.png
[image-id-9-2]: images/9-uptime.png
[image-id-9-3]: images/9-users.png
[image-id-9-4]: images/9-load.png
[image-id-9-5]: images/9-tasks.png
[image-id-9-6]: images/9-cpu.png
[image-id-9-7]: images/9-memory.png
[image-id-9-8]: images/9-pid-mem.png
[image-id-9-9]: images/9-pid-time.png
[image-id-9-10]: images/9-htop.png
[image-id-9-11]: images/9-htop-pid.png
[image-id-9-12]: images/9-htop-percent-cpu.png
[image-id-9-13]: images/9-htop-percent-mem.png
[image-id-9-14]: images/9-htop-time.png
[image-id-9-15]: images/9-htop-sort-sshd.png
[image-id-9-16]: images/9-htop-find-syslog.png
[image-id-10-1]: images/10-sudo-fdisk-l.png
[image-id-10-2]: images/10-disk-name.png
[image-id-10-3]: images/10-disk-mem.png
[image-id-10-4]: images/10-disk-sectors.png
[image-id-10-5]: images/10-disk-swap.png
[image-id-11-1]: images/11-df.png
[image-id-11-2]: images/11-df-mem.png
[image-id-11-3]: images/11-df-mem-used.png
[image-id-11-4]: images/11-df-mem-free.png
[image-id-11-5]: images/11-df-mem-use-percent.png
[image-id-11-6]: images/11-df-Th.png
[image-id-11-7]: images/11-df-Th-mem.png
[image-id-11-8]: images/11-df-Th-mem-used.png
[image-id-11-9]: images/11-df-Th-mem-free.png
[image-id-11-10]: images/11-df-Th-mem-use-percent.png
[image-id-11-11]: images/11-df-Th-type.png
[image-id-12-1]: images/12-du.png
[image-id-12-2]: images/12-du-size-dir.png
[image-id-12-3]: images/12-du-size-var-log.png
[image-id-13-1]: images/13-ncdu-home.png
[image-id-13-2]: images/13-ncdu-var.png
[image-id-13-3]: images/13-ncdu-var-log.png
[image-id-14-1]: images/14-var-log-dmesg.png
[image-id-14-2]: images/14-var-log-syslog.png
[image-id-14-3]: images/14-var-log-auth.png
[image-id-14-4]: images/14-last.png
[image-id-14-5]: images/14-ssh-res.png
[image-id-14-6]: images/14-var-log-syslog-res.png
[image-id-15-1]: images/15-crontab-e.png
[image-id-15-2]: images/15-crontab-l.png
[image-id-15-3]: images/15-grep-cron.png
[image-id-15-4]: images/15-crontab-r-l.png

## Операционные системы UNIX/Linux (Базовый).

## Contents
- [Операционные системы UNIX/Linux (Базовый).](#операционные-системы-unixlinux-базовый)
- [Contents](#contents)
- [Part 1. Установка ОС.](#part-1-установка-ос)
- [Part 2. Создание пользователя.](#part-2-создание-пользователя)
- [Part 3. Настройка сети ОС.](#part-3-настройка-сети-ос)
- [Part 4. Обновление ОС.](#part-4-обновление-ос)
- [Part 5. Использование команды sudo.](#part-5-использование-команды-sudo)
- [Part 6. Установка и настройка службы времени.](#part-6-установка-и-настройка-службы-времени)
- [Part 7. Установка и использование текстовых редакторов.](#part-7-установка-и-использование-текстовых-редакторов)
- [Part 8. Установка и базовая настройка сервиса SSHD.](#part-8-установка-и-базовая-настройка-сервиса-sshd)
- [**Bonus*. Настройка SSH подключения.](#bonus-настройка-ssh-подключения)
- [Part 9. Установка и использование утилит **top**, **htop**.](#part-9-установка-и-использование-утилит-top-htop)
- [Part 10. Использование утилиты **fdisk**.](#part-10-использование-утилиты-fdisk)
- [Part 11. Использование утилиты **df**.](#part-11-использование-утилиты-df)
- [Part 12. Использование утилиты **du**.](#part-12-использование-утилиты-du)
- [Part 13. Установка и использование утилиты **ncdu**.](#part-13-установка-и-использование-утилиты-ncdu)
- [Part 14. Работа с системными журналами.](#part-14-работа-с-системными-журналами)
- [Part 15. Использование планировщика заданий **CRON**.](#part-15-использование-планировщика-заданий-cron)
## Part 1. Установка ОС.
* Скачиваем `iso` образ [ubuntu-20.04-live-server](https://old-releases.ubuntu.com/releases/20.04.0/ubuntu-20.04-live-server-amd64.iso), далее следуем [инструкции](https://linuxconfig.org/how-to-install-ubuntu-20-04-on-virtualbox) по установке `iso` образа в VirtualBox. После всех шагов, проверяем установленную версию командой:

`cat /etc/issue`

![image-id-1][]

## Part 2. Создание пользователя.
* Для создания пользователя с разрешением на прочтение логов из папки /var/log его следует сразу включить в группу adm (группа для чтения логов):

`sudo useradd -G adm username`

![image-id-2-1][]

* Список пользовательских учётных записей содержиться в файле `/etc/passwd`:

`cat /etc/passwd | tail`

![image-id-2-2][]

* Чтобы просмотреть группы, которым назначена текущая учетная запись пользователя, выполните команду groups. Вы увидите список групп:    
      
`groups` при наличии другого пользователя `groups имя пользователя`

![image-id-2-3][]
 ## Part 3. Настройка сети ОС.

* С помощью команд:
1. Задаём название машины
`sudo hostnamectl set-hostname user-1`
2. Задаем временную зону
`sudo timedatectl set-timezone Europe/Moscow`
3. Выводит список таймзон
`timedatectl list-timezones`
4. Ip адрес устройства
`hostname -I`
5. Внешний ip-адрес
`curl 2ip.ru`
6. Внутренний IP-адрес шлюза (gw)
`ip r | grep def | grep -Eo '[0-9.]*' | head -n 1`
7. Выводим названия сетевых интерфейсов
`ifconfig`

* **lo** - интерфейс обратной петли (loopback) позволяет компьютеру обращатся к самому себе. Интерфейс имеет ip-адрес 127.0.0.1 и может быть использован сетевым клиентским программным обеспечением, чтобы общаться с серверным приложением, расположенным на том же компьютере.
* **DHCP (Dynamic Host Configuration Protocol)** — протокол прикладного уровня модели TCP/IP, служит для автоматизации назначения IP-адреса клиенту. Сервер всегда слушает 67 порт, ожидает широковещательное сообщение от клиента, а после его получения отправляет ответное предложение — DHCPOFFER. Клиент принимает сообщение на 68 порту.
*  Задаем статичные настройки **ip, gw, dns** в файле конфигурации netplan:

1. `cd /etc/netplan/`
2. `sudo chmod 777 00-installer-config.yaml`
3. `sudo mv /etc/netplan/00-installer-config.yaml{,.orig} && vim /etc/netplan/00-installer-config.yaml`
4. `sudo netplan apply`
5. `sudo reboot`
*
      # This is the network config written by 'subiquity'
      network:
         ethernets:
          enp0s3:
            addresses: 
            - 10.0.2.16/24
            gateway4: 10.0.2.2
            nameservers:
              addresses: [10.0.2.2, 1.1.1.1]
            optional: true
         version: 2
*  пинг с новыми настрйками 

`hostname -I && ping -c 4 1.1.1.1 | grep "stat\|loss" && ping -c 4 ya.ru | grep "stat\|loss"`

![image-id-3][]

## Part 4. Обновление ОС.

* Обновляем пакеты до последней на момент выполнения задания версии.

1. `sudo apt-get update`
2. `sudo apt-get upgrade -y` 
3. `clear`
4. `sudo apt-get upgrade -y | tail -n 1`

![image-id-4][]


## Part 5. Использование команды sudo.

* sudo (англ. Substitute User and do, дословно «подменить пользователя и выполнить») — программа для системного администрирования UNIX-систем, позволяющая делегировать те или иные привилегированные ресурсы пользователям с ведением протокола работы. Основная идея — дать пользователям как можно меньше прав, при этом достаточных для решения поставленных задач.
Команда sudo предоставляет возможность пользователям выполнять команды от имени суперпользователя root, либо других пользователей. Правила, используемые sudo для принятия решения о предоставлении доступа, находятся в файле /etc/sudoers (для редактирования файла можно использовать специальный редактор visudo, запускаемый из командной строки без параметров, в том числе без указания пути к файлу); язык их написания и примеры использования подробно изложены в man sudoers.
В большинстве случаев грамотная настройка sudo делает небезопасную работу от имени суперпользователя ненужной. Все действия оказываются выполнимы из-под аккаунта пользователя, которому разрешено использовать sudo без ограничений. Имеется возможность запрещать и разрешать определённым пользователям или группам выполнение конкретного набора программ, а также разрешить выполнение определённых программ без необходимости ввода своего пароля.
* Меняем hostname ОС от имени пользователя, созданного в пункте Part 2

1. задаём пользователю пароль
`echo -e "1\n1" | sudo passwd username`
2. Добавляем пользователя в группу sudo
`sudo adduser username sudo`
3. Чистим чтобы ничего не мешало
`clear`
4. Меняем имя hostname от имени второго пользователя (**eeveegod2**)
`sudo -u username sudo hostnamectl set-hostname ignis`
5. Проверяем имя
`hostname`

![image-id-5][]

## Part 6. Установка и настройка службы времени.
    
`date`  
`timedatectl show`

![image-id-6][]

## Part 7. Установка и использование текстовых редакторов.

**NANO**

  * `nano test_nano.txt`
  * Введите свой ник (**eeveegod**)
  * Нажмите `Cmd+O`, `Enter` для сохранения и `Cmd+X` для выхода

![image-id-7-nano-1][]

  * `nano test_nano.txt`
  * Нажимте `Cmd+\`, введите строку, которую необходимо искать (**eeveegod**)
  * Нажмите клавишу `Enter`. Затем введите строку, на которую произвести замену (**21 School 21**) и нажмите `Enter`
  нажмите клавишу `A` для замены всех вхождений строки
  * Нажмите `Cmd+X` для выхода
  * Нажмите `N` для выхода без сохранения изменений

![image-id-7-nano-2][]

  * `nano test_nano.txt`
  * Нажимте `Cmd+\`, введите строку, которую необходимо искать (**eeveegod**) и нажмите клавишу `Enter`

![image-id-7-nano-3][]

  * Затем введите строку, на которую произвести замену (**Hello, world**) и нажмите `Enter`
  нажмите клавишу `A` для замены всех вхождений строки
  * Нажмите `Cmd+X` для выхода
  * Нажмите `Y` для выхода c сохранениями изменений

![image-id-7-nano-4][]

**VIM**

  * `vim test_vim.txt`
  * Нажмите клавишу `I` для режима ввода, вы увидите (**--INSERT--**) в нижнем левом углу
  * Введите свой ник (**eeveegod**)
  * Нажмите `ESC`, зажмите `Shift + :` и введите команду `wq` для выхода c сохранением

![image-id-7-vim-1][]

  * `vim test_vim.txt`
  * Нажмите клавишу `I` для режима ввода, вы увидите (**--INSERT--**) в нижнем левом углу
  * Удалите ник (**eeveegod**) и введите (**21 School 21**)
  * Нажмите `ESC`, зажмите `Shift + :` и введите команду `q!` для выхода без сохранения изменений

![image-id-7-vim-2][]

  * `vim test_vim.txt`
  * Нажимте `/`, введите строку, которую необходимо искать (**eeveegod**) и нажмите клавишу `Enter`

![image-id-7-vim-3][]

  * Для поиска с заменой зажмите `Shift + :` и вводите команду `%s/eeveegod/Hello, world` и нажмите `Enter`
  * Нажмите `ESC`, зажмите `Shift + :` и введите команду `wq` для выхода c сохранением или `q!` для выхода без сохранения изменений

![image-id-7-vim-4][]

**JOE**

  * `joe test_joe.txt`
  * На заметку: `^` является клавишей `Ctrl` далее различные сочетания например - `Ctrl+K`, затем клавишу `H` для вызова подсказок
  * Введите свой ник (**eeveegod**)
  * Первый вариант: Зажмите `Ctrl+K`, а затем клавишу `Q`. Эта команда означает закрыть редактор, а если в файле были сделаны изменения, то вам будет предложено сохранить их. Если изменений не было, то редактор просто закроется.
  * Второй вариант: Зажмите `Ctrl+K`, затем клавишу `X` для явного сохранения с выходом из редактора
  * Третий вариант: Вы также можете сохранить файл без выхода из редактора, для этого используйте `Ctrl+K`, а затем клавишу `D`.

![image-id-7-joe-1][]

  * `joe test_joe.txt`
  * Первый вариант: Зажмите `Ctrl+K`, а затем клавишу `Q`. Эта команда означает закрыть редактор, а если в файле были сделаны изменения, то вам будет предложено сохранить их. Если изменений не было, то редактор просто закроется.
  * Нажмите `N` для выхода без сохранения изменений

![image-id-7-joe-2][]

  * `joe test_joe.txt`
  * Зажмите `Ctrl+K`, а затем клавишу `F`. Эта команда находит вводимое слово (**eeveegod**)
  * Вы увидите запрос поиска по слову (**eeveegod**): **Find (^K to abort):** **eeveegod**. Нажимаем `Enther`. 
  * Вы увидите запрос на подтверждение: **(I)gnore (R)eplace (B)ackwards Bloc(K) (^K H for help):** `i`
  * Нажмите клавишу `I` для игнорирования запроса. Нажимаем `Enther`

![image-id-7-joe-3][]

  * Зажмите `Ctrl+K`, а затем клавишу `F`. Эта команда находит вводимое слово (**eeveegod**).
  * Вы увидите запрос поиска по слову (**eeveegod**): **Find (^K to abort):** **eeveegod**. Нажимаем `Enther`. 
  * Вы увидите запрос на подтверждение: **(I)gnore (R)eplace (B)ackwards Bloc(K) (^K H for help):** `r`
  * Нажмите клавишу `R` для перезаписи. Нажимаем `Enther`
  * Вы увидите запрос для записи нового слова: (**Hello, world**): **Replace with (^K H for help):** **Hello, World**
  * Вы увидите запрос на подтверждение: **Replace (Y)es (N)o (R)est (B)ackup (X to abort)?** `r`
  * Нажмите клавишу `R` замены. Нажимаем `Enther`

![image-id-7-joe-4][]

## Part 8. Установка и базовая настройка сервиса SSHD.

* Устанавливаем и настраиваем SSH-сервер с помощью команд:

1. Обновлите систему
`sudo apt-get update`
2. Установите **SSHD**
`sudo apt-get install openssh-server net-tools`
3. Добавьте сервер в автозапуск
`sudo systemctl enable ssh`
4. Измените порт
`sudo sed -i '/Port/c\Port 2022' /etc/ssh/sshd_config`
5. Перезапуск **SSHD**
`sudo systemctl restart sshd`
6. Очистка терминала
`clear`
7. Запустите утилиту **ps**
`ps -C sshd`
8. Запустите утилиту **netstat**
`netstat -tan`

![image-id-8][]

* Опции утилиты **ps**:
  * -A, -e - выбрать все процессы;
  * -a - выбрать все процессы, кроме фоновых;
  * -d - выбрать все процессы, даже фоновые, кроме процессов сессий;
  * -N - выбрать все процессы кроме указанных;
  * -С - выбирать процессы по имени команды;
  * -G - выбрать процессы по ID группы;
  * -p - выбрать процессы PID;
  * --ppid - выбрать процессы по PID родительского процесса;
  * -s - выбрать процессы по ID сессии;
  * -t - выбрать процессы по tty;
  * -u - выбрать процессы пользователя;
  * -x - найти все вхождения строки поиска.
  * Опции форматирования:
    * -с - отображать информацию планировщика;
    * -f - вывести максимум доступных данных, например, количество потоков;
    * -F - аналогично -f, только выводит ещё больше данных;
    * -l - длинный формат вывода;
    * -j - вывести процессы в стиле Jobs, минимум информации;
    * -M - добавить информацию о безопасности;
    * -o - позволяет определить свой формат вывода;
    * --sort - выполнять сортировку по указанной колонке;
    * -L - отображать потоки процессов в колонках LWP и NLWP;
    * -m - вывести потоки после процесса;
    * -V - вывести информацию о версии;
    * -H - отображать дерево процессов.

* Опции утилиты **netstat**:
  * -n - Отображение адресов и номеров портов в числовом формате.
  * -a - Отображение всех подключений и ожидающих портов.
  * -t - Отображение текущего подключения в состоянии переноса нагрузки с процессора на сетевой адаптер при передаче данных.

## **Bonus*. Настройка SSH подключения.

* Скрипт для генерации списка картинок:

`ls -1 | cat -n | sed -e 's/ \+/[image_id_/' -e 's/\t/]: image\//'`

## Part 9. Установка и использование утилит **top**, **htop**.

* Командой `top` запускаем соответствующую утилиту

![image-id-9-1][]

* Uptime

![image-id-9-2][]

* Количество авторизированных пользователей

![image-id-9-3][]

* Общая загрузка системы

![image-id-9-4][]

* Общее количество процессов

![image-id-9-5][]

* Загрузка CPU

![image-id-9-6][]

* Загрузка MEM

![image-id-9-7][]

* PID процесса, занимающего больше всего памяти:

* (`M` (**Shift + M**) — сортировка по используемой памяти

![image-id-9-8][]

* PID процесса, занимающего больше всего процессорного времени:

* (`T` (**Shift + T**) — сортировка по времени работы процесса)

![image-id-9-9][]

* Командой `htop` запускаем утилиту

![image-id-9-10][]

* Для выбора типа сортировки нажмите клавишу `F6`

* PID

![image-id-9-11][]

* PERCENT_CPU

![image-id-9-12][]

* PERCENT_MEM

![image-id-9-13][]

* TIME

![image-id-9-14][]

* Для работы с фильтром нажмите клавишу `F4`. После введите `SSHd` и нажимите `Enter`
* Фильтр по SSHd

![image-id-9-15][]

* Для работы с поиском нажмите клавишу `F3`. После введите `syslog` и нажимите `Enter`
* Результат поиска

![image-id-9-16][]

## Part 10. Использование утилиты **fdisk**.

* Запуск утилиты командой `sudo fdisk -l`

![image-id-10-1][]

* Название жесткого диска VBOX HARDDISK

![image-id-10-2][]

* Размер

![image-id-10-3][]

* Количество секторов

![image-id-10-4][]

* Размер swap (команда `free -h`)

![image-id-10-5][]

## Part 11. Использование утилиты **df**.

* Запустите команду `df /`

![image-id-11-1][]

* Размер раздела

![image-id-11-2][]

* Размер занятого пространства

![image-id-11-3][]

* Размер свободного пространства

![image-id-11-4][]

* Процент использования

![image-id-11-5][]

* Единица измерения в выводе: **Кб**.

* используем команду `df -Th /`

![image-id-11-6][]

* Размер раздела

![image-id-11-7][]

* Размер занятого пространства

![image-id-11-8][]

* Размер свободного пространства

![image-id-11-9][]

* Процент использования

![image-id-11-10][]

* Тип файловой системы для раздела

![image-id-11-11][]

## Part 12. Использование утилиты **du**.

* Запуcк команды `du`

![image-id-12-1][]

* С помощью команды `sudo du -s -h /home && sudo du -s -h /var && sudo du -s -h /var/log` выводим размер папок

![image-id-12-2][]
    
* Вывести размер `/var/log` с помощью команды `sudo du -a -h /var/log`

![image-id-12-3][]

## Part 13. Установка и использование утилиты **ncdu**.

* Командой `sudo apt install ncdu` устанавливаем **ncdu**.

* Перед вводом команды `ncdu`, введите из домашней дирректории `cd ..`, вы должны попасть в `/home/ваш ник`

* Вывести размер папок с помощью команды `ncdu`

* Размер `/home/`. Введите `ncdu`

![image-id-13-1][]

* Размер `cd /var/`. Введите `ncdu`

![image-id-13-2][]

* Размер `cd /var/log/`. Введите `ncdu`

![image-id-13-3][]

## Part 14. Работа с системными журналами.

* Просмотр **/var/log/dmesg**

![image-id-14-1][]

* Просмотр **/var/log/syslog**

![image-id-14-2][]

* Просмотр **/var/log/auth.log**

![image-id-14-3][]

* Для просмотра последней авторизации, имени пользователя и метода входа в систему используем команду `last`

![image-id-14-4][]

* Время авторизации **Jul 30 21:44**
* Имя пользователя **eeveegod**
* Метод входа в систему **tty1**

* Команда `sudo /etc/init.d/ssh restart` перезапускает службу SSHd

![image-id-14-5][]

* Команда `sudo cat /var/log/syslog` выводит сообщение о рестарте служб

![image-id-14-6][]

## Part 15. Использование планировщика заданий **CRON**.

* Используйте команду `sudo apt install cron` для установки **CRON**

* Планируем задачу командой `crontab -e`.

* Выйдет список редакторов которые у вас есть, я выбрал **vim.basic** нажав соответствующую цифру по списку.

* В vim приписываем ***/2 * * * * uptime**

![image-id-15-1][]

* Командой `crontab -l` выводим список установленых задач

![image-id-15-2][]

* Командой `sudo grep CRON /var/log/syslog` выводим системных задач. 

* Также можете установить `sudo apt-get install postfix`

* Выбираете **local**, имя **root** пользователя (**eeveegod**), далее не вносите изменений в конфигурацию и пропускайте шаги установки до конца.

* Это поможет устранить ошибку **No MTA installed, discarding output errors**

![image-id-15-3][]

* Командой `crontab -r` удаляем все запланированые задачи

* Проверяем список задач ещё раз

![image-id-15-4][]
